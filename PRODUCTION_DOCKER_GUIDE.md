# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–æ–¥–∞–∫—à–Ω‚Äë–∑–∞–ø—É—Å–∫—É Docker‚Äë—Å—Ç–µ–∫–∞ FinHub

–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã —Å Docker‚Äë–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω‚Äë—Å–µ—Ä–≤–µ—Ä–µ**.  
–¶–µ–ª—å ‚Äî –µ–¥–∏–Ω—ã–π `.env`, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Å—Ç–∞—Ä—Ç/—Ä–µ—Å—Ç–∞—Ä—Ç —Å—Ç–µ–∫–∞ –∏ –º–∏–Ω–∏–º—É–º —Ä—É—á–Ω–æ–π –º–∞–≥–∏–∏.

---

## 1. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

- **–ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ (read‚Äëonly):**
  - `/srv/www/finhub/` ‚Äî –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ (git‚Äë—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, `manage.py`, `Dockerfile`, –∏ —Ç.–¥.)
- **–ï–¥–∏–Ω—ã–π `.env` (–∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è):**
  - `/srv/www/finhub/.env`
- **–ü—Ä–æ–¥–∞–∫—à–Ω‚Äëcompose —Ñ–∞–π–ª:**
  - `/srv/compose/finhub.yml`

> **–í–∞–∂–Ω–æ:** `.env` –Ω–µ –¥—É–±–ª–∏—Ä—É–µ–º. –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã (web, bot, db, redis) –∏ `docker compose`
> –ø–æ–ª—É—á–∞—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∏–∑ `/srv/www/finhub/.env`.

---

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `.env` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞

–ü—Ä–∏–º–µ—Ä `/srv/www/finhub/.env`:

```env
# Django / –ë–î
DJANGO_ENVIRONMENT=production
DEBUG=False
SECRET_KEY=your-strong-secret-key

DB_NAME=finhub
DB_USER=finhub_user
DB_PASSWORD=very-strong-db-password
DB_HOST=db

ALLOWED_HOSTS=your.domain,localhost

# Redis / Bot
REDIS_URL=redis://redis:6379/1
TELEGRAM_BOT_TOKEN=your-telegram-bot-token

# SSL –∫ –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# DB_SSLMODE=disable    # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: disable (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π Postgres –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏)
# DB_SSLMODE=require    # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–Ω–µ—à–Ω–∏–π managed Postgres —Å TLS
```

---

## 3. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ `finhub.yml` (prod‚Äëdocker‚Äëcompose)

–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã (—Å—Ö–µ–º–∞—Ç–∏—á–Ω–æ):

```yaml
services:
  db:
    image: postgres:16
    env_file:
      - /srv/www/finhub/.env
    environment:
      POSTGRES_DB: ${DB_NAME}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data

  web:
    build: /srv/www/finhub
    env_file:
      - /srv/www/finhub/.env
    environment:
      DJANGO_ENVIRONMENT: production
      DB_HOST: db
      REDIS_URL: redis://redis:6379/1
    # gunicorn –∏–ª–∏ –¥—Ä—É–≥–æ–π WSGI‚Äë—Å–µ—Ä–≤–µ—Ä –Ω–∞ 8000
    # ports / reverse proxy –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ (nginx/traefik)

  bot:
    build: /srv/www/finhub
    env_file:
      - /srv/www/finhub/.env
    environment:
      DJANGO_ENVIRONMENT: production
      DB_HOST: db
      REDIS_URL: redis://redis:6379/1

  redis:
    image: redis:7

volumes:
  postgres_data:
```

> **–ò–¥–µ—è:** –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —á–∏—Ç–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `.env`, –∞ –∑–Ω–∞—á–µ–Ω–∏—è `DB_*` –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
> –∏ Django, –∏ Postgres‚Äë–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º.

---

## 4. –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–µ–∫–æ–º

–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º **–æ–¥–Ω—É –∏ —Ç—É –∂–µ —Ñ–æ—Ä–º—É** –∫–æ–º–∞–Ω–¥ —Å `--env-file`:

```bash
cd /srv/compose

# –ü–µ—Ä–≤–∏—á–Ω—ã–π –∑–∞–ø—É—Å–∫ / –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
docker compose \
  --env-file /srv/www/finhub/.env \
  -f finhub.yml \
  up -d --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
docker compose \
  --env-file /srv/www/finhub/.env \
  -f finhub.yml \
  ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ web –∏ bot
docker compose \
  --env-file /srv/www/finhub/.env \
  -f finhub.yml \
  restart web bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–µ–∫–∞
docker compose \
  --env-file /srv/www/finhub/.env \
  -f finhub.yml \
  down
```

### 4.1. –¢–∏–ø–æ–≤–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –¥–µ–ø–ª–æ–π –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ (–ø–æ—Å–ª–µ `git pull`)

**–°—Ü–µ–Ω–∞—Ä–∏–π:** —Ç—ã –ø–æ–º–µ–Ω—è–ª –∫–æ–¥ –≤ Git (–∏–ª–∏ —Å–º–µ—Ä–∂–∏–ª pull request) –∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –Ω–∞ –ø—Ä–æ–¥–µ –ø–æ–µ—Ö–∞–ª–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è.

#### 4.1.0. –í–∞–∂–Ω–æ –ø—Ä–æ –º–∏–≥—Ä–∞—Ü–∏–∏ (—á—Ç–æ–±—ã –Ω–µ –ª–æ–≤–∏—Ç—å —Å—é—Ä–ø—Ä–∏–∑—ã –Ω–∞ –ø—Ä–æ–¥–µ)

**–ü—Ä–∞–≤–∏–ª–æ:** –µ—Å–ª–∏ —Ç—ã –º–µ–Ω—è–ª `models.py` (–¥–æ–±–∞–≤–∏–ª –ø–æ–ª—è/—Ç–∞–±–ª–∏—Ü—ã/–∏–Ω–¥–µ–∫—Å—ã/constraints) ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **—Å–æ–∑–¥–∞–Ω—ã –∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã** –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º.

- **–ü–µ—Ä–µ–¥ –ø—É—à–µ–º / –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ CI):**

  ```bash
  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ. –ï—Å–ª–∏ Django –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî –∑–Ω–∞—á–∏—Ç —Ç—ã –∑–∞–±—ã–ª –∏—Ö —Å–æ–∑–¥–∞—Ç—å/–∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
  python manage.py makemigrations --check --dry-run
  ```

- **–ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –≤—ã—à–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∑–Ω–∞—á–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–π –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç):**

  ```bash
  # 1) –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ
  python manage.py makemigrations

  # 2) –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–ª–∏—Å—å –∏ –ø–æ–ø–∞–ª–∏ –≤ git
  git status

  # 3) –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º
  git add .
  git commit -m "Add migrations"
  git push
  ```

- **–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ:** Django —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç **—Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–µ–ª–µ–π** –∏ **—Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π**.  
  –ï—Å–ª–∏ –æ–Ω–∏ —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è, –Ω–∞ –ø—Ä–æ–¥–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤–∏–¥–∞:
  - `Your models in app(s) ... have changes that are not yet reflected in a migration`

- **–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –ª–æ–∂–Ω—ã—Ö ‚Äú–∏–∑–º–µ–Ω–µ–Ω–∏–π‚Äù –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π —Å–º–µ–Ω—ã —Å—Ö–µ–º—ã:**
  - **–ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é** (–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ—Å–æ–∑–Ω–∞–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π).
  - –î–ª—è `models.Index(...)` –∏ `UniqueConstraint(...)` **–∑–∞–¥–∞–≤–∞–π `name=` —è–≤–Ω–æ**.  
    –ò–Ω–∞—á–µ Django –º–æ–∂–µ—Ç ‚Äú–ø–æ‚Äë—Ä–∞–∑–Ω–æ–º—É‚Äù —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å/–∏–º–µ–Ω–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç, –∏ –æ–Ω –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –º–æ–¥–µ–ª–∏ ‚Äú–∏–∑–º–µ–Ω–∏–ª–∏—Å—å‚Äù, —Ö–æ—Ç—è —Ç–∞–±–ª–∏—Ü–∞ —Ç–∞ –∂–µ.

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH**

   ```bash
   ssh your-user@your-server
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ Git**

   ```bash
   cd /srv/www/finhub
   git pull origin main      # –∏–ª–∏ –¥—Ä—É–≥–∞—è –Ω—É–∂–Ω–∞—è –≤–µ—Ç–∫–∞
   ```

3. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ `web` –∏ `bot`**

   ```bash
   cd /srv/compose

   docker compose \
     --env-file /srv/www/finhub/.env \
     -f finhub.yml \
     up -d --build web bot
   ```

   - `--build` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–±—Ä–∞–∑ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º.
   - `web` –∏ `bot` –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è, **–ë–î –∏ Redis –Ω–µ —Ç—Ä–æ–≥–∞–µ–º**.

4. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –º–µ–Ω—è–ª–∞—Å—å —Å—Ö–µ–º–∞ –ë–î)**

   > –≠—Ç–æ—Ç —à–∞–≥ –±–µ–∑–æ–ø–∞—Å–µ–Ω: Django –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏.

   ```bash
   cd /srv/compose

   docker compose \
     --env-file /srv/www/finhub/.env \
     -f finhub.yml \
     exec web python manage.py migrate
   ```

   –ü–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ–º–Ω–µ–Ω–∏—è:

   ```bash
   # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–π
   docker compose \
     --env-file /srv/www/finhub/.env \
     -f finhub.yml \
     exec web python manage.py showmigrations --plan

   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —É Django –Ω–µ—Ç ‚Äú–Ω–µ–æ—Ç—Ä–∞–∂–µ–Ω–Ω—ã—Ö‚Äù –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–æ–¥–µ–ª–µ–π (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å No changes detected)
   docker compose \
     --env-file /srv/www/finhub/.env \
     -f finhub.yml \
     exec web python manage.py makemigrations --check --dry-run
   ```

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**

   ```bash
   docker compose \
     --env-file /srv/www/finhub/.env \
     -f finhub.yml \
     ps
   ```

6. **(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏, –µ—Å–ª–∏ —á—Ç–æ‚Äë—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫**

   ```bash
   docker compose \
     --env-file /srv/www/finhub/.env \
     -f finhub.yml \
     logs web --since=2m

   docker compose \
     --env-file /srv/www/finhub/.env \
     -f finhub.yml \
     logs bot --since=2m
   ```

### 4.2. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è —Ç–æ–ª—å–∫–æ `.env` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Ç–æ–∫–µ–Ω—ã –∏ —Ç.–ø.)

**–°—Ü–µ–Ω–∞—Ä–∏–π:** —Ç—ã –ø–æ–ø—Ä–∞–≤–∏–ª `/srv/www/finhub/.env`, –Ω–æ –∫–æ–¥ –Ω–µ –º–µ–Ω—è–ª.

1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `.env` —Å–æ—Ö—Ä–∞–Ω—ë–Ω.
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã **–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞**:

   - –ï—Å–ª–∏ –ø–æ–º–µ–Ω—è–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Django/–±–æ—Ç–∞:

     ```bash
     cd /srv/compose

     docker compose \
       --env-file /srv/www/finhub/.env \
       -f finhub.yml \
       restart web bot
     ```

   - –ï—Å–ª–∏ –ø–æ–º–µ–Ω—è–ª–∏—Å—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î (–ø–∞—Ä–æ–ª—å –∏ —Ç.–ø.):

     ```bash
     cd /srv/compose

     docker compose \
       --env-file /srv/www/finhub/.env \
       -f finhub.yml \
       restart db web bot
     ```

### 4.3. –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –Ω—É–∂–Ω–æ ‚Äú–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë‚Äù (—Ä–µ–¥–∫–æ, –Ω–æ –±—ã–≤–∞–µ—Ç).

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–µ–∫:

   ```bash
   cd /srv/compose

   docker compose \
     --env-file /srv/www/finhub/.env \
     -f finhub.yml \
     down
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ (—Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π –æ–±—Ä–∞–∑–æ–≤):

   ```bash
   docker compose \
     --env-file /srv/www/finhub/.env \
     -f finhub.yml \
     up -d --build
   ```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏ –ª–æ–≥–∏ (–∫–∞–∫ –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö 4.1 –∏ 5).

---

## 5. –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. **–°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**

```bash
docker compose \
  --env-file /srv/www/finhub/.env \
  -f finhub.yml \
  ps
```

–û–∂–∏–¥–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: `Up` –¥–ª—è `db`, `web`, `bot`, `redis`.

2. **–õ–æ–≥–∏ –ë–î (–ø–∞—Ä–æ–ª—å / –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)**

```bash
docker compose \
  --env-file /srv/www/finhub/.env \
  -f finhub.yml \
  logs db --since=2m
```

–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–æ `FATAL: password authentication failed` –∏–ª–∏ –ø—É—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å.

3. **–õ–æ–≥–∏ web (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î / SSL)**

```bash
docker compose \
  --env-file /srv/www/finhub/.env \
  -f finhub.yml \
  logs web --since=2m
```

- –ù–µ—Ç –æ—à–∏–±–æ–∫ `could not translate host name "db"`  
- –ù–µ—Ç –æ—à–∏–±–æ–∫ SSL –∫ –ë–î, –µ—Å–ª–∏ `DB_SSLMODE=disable` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π Postgres.

4. **–õ–æ–≥–∏ –±–æ—Ç–∞**

```bash
docker compose \
  --env-file /srv/www/finhub/.env \
  -f finhub.yml \
  logs bot --since=2m
```

- –ë–æ—Ç –ø–∏—à–µ—Ç, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ  
- –ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –ø–∞–¥–µ–Ω–∏–π –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫ –ë–î.

---

## 6. Best practices –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏—è

- **–û–¥–∏–Ω `.env` –Ω–∞ –ø—Ä–æ–µ–∫—Ç** ‚Äî `/srv/www/finhub/.env`, –±–µ–∑ –∫–æ–ø–∏–π –∏ –¥—É–±–ª–µ–π.
- **–ù–∏–∫–∞–∫–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ git** ‚Äî `.env` –≤—Å–µ–≥–¥–∞ –≤ `.gitignore`.
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —á–∏—Ç–∞—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (`env_file` + `--env-file`).
- –î–ª—è SSL –∫ –ë–î:
  - –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–π —Å–µ—Ç–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ–º `DB_SSLMODE=disable`.
  - –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –≤–Ω–µ—à–Ω–µ–º—É Postgres –≤–∫–ª—é—á–∞–µ–º `DB_SSLMODE=require` —Ç–æ–ª—å–∫–æ –≤ `.env`.
- –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–Ω–∞—á–∞–ª–∞ –≤–Ω–æ—Å–∏–º –≤ git‚Äë—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–∫–æ–¥/compose/–≥–∞–π–¥—ã),
  –∑–∞—Ç–µ–º –¥–µ–ø–ª–æ–∏–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º `Summary.md`.

## 7. –ö–∞–∫ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

**–¶–µ–ª—å:** —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–π —Å—Ç–µ–∫ (`compose-*`), –∞ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (`finhub-*`) –Ω–µ –º–µ—à–∞–ª–∏.

1. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º**

   ```bash
   docker ps --format 'table {{.Names}}\t{{.Status}}' | grep -E 'finhub|compose' || true
   ```

2. **–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∞–∫—Ç–∏–≤–Ω—ã —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–∏–¥–∞ `compose-web-1`, `compose-bot-1`, `compose-db-1`, `compose-redis-1`.**

   - –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–∏–¥–∞ `finhub-web-1`, `finhub-bot-1` –∏ —Ç.–ø. ‚Äî —ç—Ç–æ —Å—Ç–∞—Ä—ã–π —Å—Ç–µ–∫.

3. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫**

   –ü—Ä–∏–º–µ—Ä (–Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –ø–æ —Ñ–∞–∫—Ç—É –≤—ã–≤–æ–¥–∞ `docker ps`):

   ```bash
   # –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
   docker stop finhub-web-1 finhub-bot-1 finhub-db-1 finhub-redis-1 2>/dev/null || true

   # –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å
   docker update --restart=no finhub-web-1 finhub-bot-1 finhub-db-1 finhub-redis-1 2>/dev/null || true
   ```

4. **–ï—Å–ª–∏ —Å—Ç–∞—Ä—ã–π —Å—Ç–µ–∫ –∑–∞–ø—É—Å–∫–∞–ª—Å—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π compose‚Äë—Ñ–∞–π–ª**

   –ï—Å–ª–∏ —Ç—ã –∑–Ω–∞–µ—à—å –ø—É—Ç—å –∫ —Å—Ç–∞—Ä–æ–º—É `docker-compose.yml` / `finhub-old.yml`:

   ```bash
   cd /path/to/old/compose

   docker compose down
   ```

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ—Ç –ª–∏ systemd‚Äë—é–Ω–∏—Ç–æ–≤ –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ —Å—Ç–µ–∫–∞**

   ```bash
   systemctl list-units | grep -i finhub || true
   ```

   –ï—Å–ª–∏ –Ω–∞–π–¥—É—Ç—Å—è —Å—Ç–∞—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –∏—Ö –º–æ–∂–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å:

   ```bash
   sudo systemctl disable --now finhub-bot.service    # –ø—Ä–∏–º–µ—Ä –∏–º–µ–Ω–∏
   sudo systemctl disable --now finhub-web.service
   ```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å—Ç–µ–∫, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —É–ø—Ä–∞–≤–ª—è–µ—à—å —á–µ—Ä–µ–∑ `/srv/compose/finhub.yml`.


